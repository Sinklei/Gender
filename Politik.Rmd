---
title: "Politik"
author: "Kevin"
date: "7/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(dplyr)
library(packcircles)
```


```{r, include=TRUE}
# datensätze einlesen und cleanen/ordnen
# ------------------------------------------
  

### 1 bundestag

# selbst generierter Datensatz aus Wikipedia Tabelle (https://de.wikipedia.org/wiki/Frauenanteil_im_Deutschen_Bundestag_seit_1949)
# datensatz zeigt die anzahl/prozente von männern und frauen in den bundestagen an


bundestag_raw <- read.csv("data/to_work_with/bundestagzusammensetzung.csv") %>% 
                  mutate(maenner_anzahl = (mitglieder-frauen_anzahl),
                          maenner_perc = (100-frauen_perc))

bundestag <- bundestag_raw[c(1,2,3,7,6,4,5)]

# cleaning: ordinale variable für bundestag

scale.bundestag <- c("1. Bundestag 1949-1953",
                     "2. Bundestag 1953-1957",
                     "3. Bundestag 1957-1961",
                     "4. Bundestag 1961-1965",
                     "5. Bundestag 1965-1969",
                     "6. Bundestag 1969-1972",
                     "7. Bundestag 1972-1976",
                     "8. Bundestag 1976-1980",
                     "9. Bundestag 1980-1983",
                     "10. Bundestag 1983-1987",
                     "11. Bundestag 1987-1990",
                     "12. Bundestag 1990-1994",
                     "13. Bundestag 1994-1998",
                     "14. Bundestag 1998-2002",
                     "15. Bundestag 2002-2005",
                     "16. Bundestag 2005-2009",
                     "17. Bundestag 2009-2013",
                     "18. Bundestag 2013-2017",
                     "19. Bundestag 2017-2021",
                     "20. Bundestag 2021"
                     )

bundestag$bundestag <- ordered(bundestag$bundestag, levels = scale.bundestag)


# ------------------------------------------


### 2 parteien_frauen

# selbst generierter Datensatz aus Wikipedia Tabelle (https://de.wikipedia.org/wiki/Frauenanteil_im_Deutschen_Bundestag_seit_1949)
# datensatz zeigt die anzahl/prozente von Frauen in den einzelnen Parteien


parteien_frauen <- read.csv("data/to_work_with/zusammensetzung_frauen_parteien.csv")


# kann man vielleicht hinzufügen, wenn es genug daten geben sollte.
#mutate(maenner_anzahl = (mitglieder-frauen_anzahl),
#maenner_perc = (100-frauen_perc))


# cleaning: ordinale variable für bundestag

parteien_frauen$bundestag <- ordered(parteien_frauen$bundestag, levels = scale.bundestag)



# -----------------------------------------

### 3 SEATS DATENSATZ

# datensatz zeigt prozente von frauen in parlamenten aus verschiedenen ländern


before_clean_seats <- read.csv("data/raw/before_clean_seats_parliaments.csv", check.names = F)

seats <- before_clean_seats %>% 
            filter(country != "") %>% 
            pivot_longer(cols = -country, names_to = "year", values_to = "n") %>% 
            mutate_if(is.numeric, round) %>% 
            filter(n != "NA") %>% 
            filter(country != "High income")

names(seats)[1] <- "region"
names(seats)[3] <- "percentage"
seats$year <- as.numeric(seats$year)


# -----------------------------------------





```
was wäre cool zu visualisieren?
wie sich das im laufe der zeit verändert hat? mit den bundestagen an sich?
verteilung dann von männern und frauen zeigen

verteilung innerhalb der parteien zeigen und wie sich diese im laufe der zeit verändert haben.

größe der parteien??




# Infotext

Statista. geschlechtliche Ungerechtigkeit in der Bundestagszusammensetzung etc.
googlen nach allgemeinem Meinungsbild zu Männer und Frauen Verteilung in der Politik
artikel von tagesschau zur zusammensetzung von männern und frauen im neuen bundestag
was gibt es sonst noch zum neuen bundestag?


# seats in parliament

von kleinem zum großen gehen können.
"wir haben die bundestagswahl 2021 hinter uns. so sieht es bei uns in deutschland aus. wie sieht es in der ganzen welt aus??"


DAS SIND NUR PROZENTE, um das besser einordnen zu können wären Gesamtzahlen und davon dann Anteil Frauen natürlich sehr sinnvoll, aber das kriegt man bestimmt nicht hin, vor allem weil das ja schon übel schwer ist, das für Deutschland herauszufinden

Hintergrundinfos:
Proportion of seats held by women in national parliaments (%)(SG.GEN.PARL.ZS)
Definition: Women in parliaments are the percentage of parliamentary seats in a single or lower chamber held by women.
Quelle: Inter-Parliamentary Union (IPU) (www.ipu.org). For the year of 1998, the data is as of August 10, 1998.
aggregation method: Weighted average

meine Quelle: https://databank.worldbank.org/source/gender-statistics

könnte auch mit Bildung zusammenhängen, dass für Frauen nicht dieselben Voraussetzungen gelten wie für Männer



```{r, datenlage checken}

# Datenlage checken

view(seats)

seats %>% 
  filter(region %in% c("Germany", "Afghanistan", "Angola", "Bahrain")) %>% 
  ggplot() +
  aes(x = year, 
      y = percentage,
      color = region) +
  geom_point() +
  NULL


seats %>% 
  ggplot() +
  aes(x = as.character(year),
      y = percentage) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot()



seats %>%
  filter(year == "2020") %>% 
  ggplot() +
  aes(x = year,
      y = percentage) +
  geom_boxplot() +
  geom_jitter(alpha = 0.4) +
  coord_flip()


seats %>% 
  filter(region == "Rwanda") %>% 
  ggplot() +
  aes(x = year,
      y = percentage) +
  geom_point()


### Welche Lände rkönnte man so nehmen für eine Grafik??
# Deutschland 31, Rwanda (max 61)


# max Rwanda 64
# min mehrere Länder mit 0 (auch Papa dings da)
# mean liegt bei 17 ca
# median bei 16
# sd bei 10

o <- seats %>% 
      filter(year == "2020",
             #percentage == "61",
             region == "Germany")

view(o)

seats %>% 
  filter(percentage > 40) %>% count()
  ggplot() +
  aes(x = year,
      y = percentage) +
  geom_jitter()




max(o$percentage)
min(seats$percentage)
mean(seats$percentage)
median(seats$percentage)
sd(seats$percentage)
range(seats$percentage)

seats %>% count(percentage, sort = T)
```


```{r, circular packing bubble plot tutorial, include=FALSE}
## circular packing // bubble plot (tutorial)

library(packcircles)

# Create data
data <- data.frame(group=paste("Group", letters[1:20]), value=sample(seq(1,100),20))

# Generate the layout. This function return a dataframe with one line per bubble. 
# It gives its center (x and y) and its radius, proportional of the value
packing <- circleProgressiveLayout(data$value, sizetype='area')
 
# We can add these packing information to the initial data frame
data <- cbind(data, packing)
 
# Check that radius is proportional to value. We don't want a linear relationship, since it is the AREA that must be proportionnal to the value
# plot(data$radius, data$value)
 
# The next step is to go from one center + a radius to the coordinates of a circle that
# is drawn by a multitude of straight lines.
dat.gg <- circleLayoutVertices(packing, npoints=50)
 
# Make the plot
ggplot() + 
  
  # Make the bubbles
  geom_polygon(data = dat.gg, aes(x, y, group = id, fill=as.factor(id)), colour = "black", alpha = 0.6) +
  
  # Add text in the center of each bubble + control its size
  geom_text(data = data, aes(x, y, size=value, label = group)) +
  scale_size_continuous(range = c(1,4)) +
  
  # General theme:
  theme_void() + 
  theme(legend.position="none") +
  coord_equal()

```

```{r, bubble plot}
# BUBBLE PLOT

library(packcircles)

# Create data (dataframe to work with)
seats_bubble <- seats %>% filter(year == "2020",
                                 region %in% c("Germany", "Switzerland", "Denmark", "Sweden", "Chad", "Papua New Guinea", "Yemen, Rep."))

# Generate the layout. This function return a dataframe with one line per bubble. 
# It gives its center (x and y) and its radius, proportional of the value
seats_packing <- circleProgressiveLayout(seats_bubble$percentage, sizetype = "area")

# We can add these packing information to the initial data frame
seats_bubble <- cbind(seats_bubble, seats_packing)

# Check that radius is proportional to value. We don't want a linear relationship, since it is the AREA that must be proportionnal to the value
#plot(seats_bubble$radius, seats_bubble$number)

# The next step is to go from one center + a radius to the coordinates of a circle that
# is drawn by a multitude of straight lines.
seats.gg <- circleLayoutVertices(seats_packing, npoints = 50)


# dass man vernünftig die zahlen da reinbekommt
seats_bubble_label <- seats_bubble %>% 
                        mutate(y = y-0.6)

# generate the plot
ggplot() +
  
  # bubble
  geom_polygon(data = seats.gg, aes(x, y, group = id, fill = as.factor(id), color = "black", alpha = 0.6)) +
  
   # Add text in the center of each bubble + control its size
  geom_text(data = seats_bubble, aes(x, y, size=percentage, label = region)) +
  geom_text(data = seats_bubble_label, aes(x, y, size=percentage, label = percentage)) +
  scale_size_continuous(range = c(1,4)) +
  
  # General theme:
  theme_void() + 
  theme(legend.position="none") +
  coord_equal()

```





# aktueller Bundestag

yeah



# Zusammensetzung Bundestag 

man kann zeigen, dass sich über die Zeit die Anzahl an Frauen im Bundestag erhöht hat
noch einzeichnen können:
* wahlperiode
* prozent der frauen, prozent der männer
* verteilung von frauen und männern?


wahlperiode komplett weg machen?? bzw wie am besten einsetzen?
mehrere geome in einen plot kriegen(vielleicht sogar zwei achsen.??)
wie kann ich das umsetzen, dass die daten nicht doppelt sind? ggf datensatz umbauen? mit hovern zum beispiel zusätzliche infos?

vor allen dingen auch verteilung gegenüber männer zeigen

zeitliche achse ist die y achse und geht von oben nach unten, so wie die website auch gestaltet ist
wichtig ist es zu zeigen, dass sich die anzahl und prozent an frauen über die jahre gesteigert hat, jedoch im vergleich zu den männern immer noch sehr klein ist


in eine grafik kriegen

* y achse bundestag in richtiger reihenfolge von oben nach unten
* frauen und männer anzahl
* vielleicht noch irgendwie prozente reinbringen
* gesamt mitgliederanzahl
* auf wahlperiode scheissen?? nur eine nehmen??


```{r}

bundestag %>%
  ggplot() +
  geom_point(mapping = aes(x = bundestag, y = frauen_anzahl, color = wahlperiode)) +
  geom_point(mapping = aes(x = bundestag, y = maenner_anzahl, color = wahlperiode)) +
  geom_point(mapping = aes(x = bundestag, y = mitglieder)) +
  coord_flip()
  NULL


bundestag %>% 
  ggplot() +
  aes(x = bundestag,
      y = frauen_perc) +
  geom_point() +
  coord_flip()
  
  


```

# Frauenanteil in den Parteien

parteimitglieder noch ergänzen?
jahre vielleicht ganz raus machen (datensatz erneuern, oder einfach commands nutzen?)
bundestag mit order (ordinale variable)
noch weitere daten dann suchen

sitzeverteilung der einzelnen bundestage vielleicht ergänzen


gibt es daten zu der anzahl der parteien und den anzahl der männer
missing values herausfindne können?

```{r}
parteien_frauen %>%
  ggplot() +
  aes(
    x = bundestag,
    y = frauen_anzahl,
    color = partei
  ) +
  geom_point() +
  coord_flip()
  NULL


  
  
parteien_frauen %>%
  ggplot() +
  aes(
    x = partei,
    y = frauen_anzahl
  ) +
  geom_col() +
  NULL


```





###### map



```{r, include=FALSE}
# MAP


# Check all available geospatial objects:
# help(package='maps')

library(maps)

# Map of the world:
map('world',col="grey", fill=TRUE, bg="white", lwd=0.05, mar=rep(0,4),border=0, ylim=c(-80,80))

mapdata <- map_data("world")

seats_map <- full_join(mapdata, seats, by = "region")

seats_map1 <- seats_map %>% filter(!is.na(seats_map$number))




map1 <- ggplot(seats_map,
        aes(x = long, y = lat, group = group)) +
        geom_polygon(aes(fill = number), color = "black")

map2 <- map1 + scale_fill_gradient(name = "Anzahl an Frauen im Parlament", low = "skyblue", high = "red", na.value = "grey50") +
         theme(axis.text.x = element_blank(),
                axis.text.y = element_blank(),
                axis.ticks = element_blank(),
                axis.title.x = element_blank(),
                axis.title.y = element_blank(),
                rect = element_blank())

map2

```




